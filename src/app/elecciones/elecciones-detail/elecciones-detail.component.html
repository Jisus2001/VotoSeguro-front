<!-- Main modal -->
<div id="authentication-modal" tabindex="-1" aria-hidden="true"
    class="fixed inset-0 z-50 flex items-center justify-center bg-gray-500 bg-opacity-75 scrollable"
    [class.hidden]="!isVisible">
    <!-- MODIFICACIÓN CLAVE: Cambiado de max-w-md a max-w-6xl para un ancho mucho mayor -->
    <div class="relative p-4 w-full max-w-6xl max-h-full">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow" style="color: rgb(5, 44, 101);">
            <div class="px-5 pt-5 flex justify-end">
                <!-- Se asume que 'closeModal()' y 'isVisible' existen en el componente TS si se usa esta estructura de modal -->
                <button type="button" (click)="closeModal()"
                    class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>

            <!-- Modal body -->
            <div>
                <!-- Contenido de la Elección (anteriormente el cuerpo de la página de detalle) -->
                <div class="p-6 md:p-8 min-h-screen">
                    <!-- Contenedor principal de la tarjeta -->
                    <mat-card *ngIf="eleccion" class="mx-auto max-w-4xl rounded-xl shadow-2xl p-6 md:p-10">

                        <!-- Modal header -->
                        <div class="flex items-center justify-center">
                            <div>
                                <h3 class="text-2xl text-center font-semibold text-[#252b36] pb-8">
                                    Detalle de la Elección: <strong>{{ eleccion.Nombre }}</strong>
                                </h3>
                            </div>
                        </div>

                        <!-- Sección de Información General de la Elección -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 text-gray-700">
                            <!-- Nombre de la Elección -->
                            <div>
                                <p class="font-semibold text-sm uppercase text-gray-500">Estado: </p>
                                <p class="text-lg font-medium">{{ estadoDinamico }}</p>
                            </div>

                            <!-- Perfil / Puesto a Elegir -->
                            <div>
                                <p class="font-semibold text-sm uppercase text-gray-500">Puesto a seleccionar</p>
                                <p class="text-lg font-medium">{{ eleccion.Perfil.Descripcion }}</p>
                            </div>

                            <!-- Sede -->
                            <div>
                                <p class="font-semibold text-sm uppercase text-gray-500">Sede de votación</p>
                                <p class="text-lg font-medium">{{ eleccion.Sede.Nombre }}</p>
                            </div>


                            <!-- Fecha de Inicio -->
                            <div>
                                <p class="font-semibold text-sm uppercase text-gray-500">Fecha de inicio</p>
                                <!-- formatDate es la función del componente TS para dar formato legible -->
                                <p class="text-lg font-medium text-green-600">{{ formatDate(eleccion.FechaInicio) }}</p>

                                <p class="font-semibold text-sm uppercase text-gray-500">Fecha de cierre</p>
                                <p class="text-lg font-medium text-red-600">{{ formatDate(eleccion.FechaFin) }}</p>
                            </div>

                        </div>

                        <!-- --- Separador --- -->
                        <div class="my-8 border-t border-gray-200"></div>

                        <!-- Sección de Candidatos -->
                        <h2 class="text-2xl font-bold text-[#252b36] mb-5 flex items-center">
                            Candidatos Registrados ( {{ eleccion.Candidatos?.length || 0 }} )
                        </h2>


                        <!-- Listado de Candidatos -->
                        <div *ngIf="eleccion.Candidatos && eleccion.Candidatos.length > 0; else noCandidatos"
                            class="space-y-4">

                            <!-- Iteración sobre la lista de candidatos -->
                            @for (candidato of eleccion.Candidatos; track candidato._id) {
                            <div
                                class="bg-white p-5 rounded-xl shadow-lg border-l-4 border-indigo-500 flex flex-col md:flex-row justify-between items-start md:items-center transition hover:shadow-xl">

                                <div class="mb-3 md:mb-0">
                                    <p class="text-xl font-bold">{{ candidato.Nombre }}</p>
                                    <p class="text-sm font-semibold">{{ candidato.Partido }}</p>
                                    <p class="text-xs text-gray-500 mt-1">ID: {{ candidato._id }}</p>
                                </div>

                                <div class="text-right">
                                    <span class="text-sm font-medium text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                                        {{ candidato.Perfil.Descripcion }}
                                    </span>
                                </div>

                                <!-- Total de Votos -->
                    
                                <div class="flex flex-col items-start md:items-end p-2 rounded-lg" style="background-color: #e6510028; align-items: center;">
                                    <p class="text-xs font-semibold">Total Votos</p>
                                    <!-- Se asume la propiedad TotalVotos existe en el objeto candidato -->
                                    <p class="text-3xl font-extrabold">{{ candidato.TotalVotos || 0 }}
                                    </p>
                                </div>

                            </div>
                            }

                        </div>

                        <!-- Template si no hay candidatos -->
                        <ng-template #noCandidatos>
                            <div class="text-center p-8 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <p class="text-lg font-medium text-yellow-800">No hay candidatos registrados aún para
                                    esta elección.</p>
                            </div>
                        </ng-template>

                    </mat-card>

                    <!-- Mensaje de carga/error si la elección no está definida -->
                    <div *ngIf="!eleccion && idEleccion" class="text-center p-10">
                        <p class="text-xl text-gray-500">Cargando detalles de la elección...</p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>