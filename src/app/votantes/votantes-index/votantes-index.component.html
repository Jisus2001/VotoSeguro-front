<div class="dashboard-wrapper">
  <app-header></app-header>
  <div class="dashboard-body">
    <aside class="sidebar">
      <app-menu></app-menu>
    </aside>

    <main class="main-content">
      <!-- Contenedor principal para aplicar estilos SCSS -->

      <!-- Encabezado y botón de acción -->
      <h1 class="page-title">Listado de Votantes</h1>

      <div class="table-card">

        <!-- Contenedor de Filtros -->
        <div class="filters-container flex w-full h-fit p-4 px-8 bg-white z-10 relative">

          <!-- Filtro por Perfil / Rol -->
          <mat-form-field class="max-w-sm mx-auto px-3">
            <mat-select [(ngModel)]="selectedRole" (selectionChange)="onFilterChange()"
              class="h-fit font-semibold rounded-lg text-sm inline-flex items-center border-gray-300"
              panelClass="role-select-panel-fix">
              @for (rol of roles; track rol.name) {
              <mat-option [value]="rol.name">
                {{ rol.label }}
              </mat-option>
              }
            </mat-select>
          </mat-form-field>


          <!-- Filtro por Cédula / Identificación -->
          <div class="max-w-md mx-auto">
            <mat-form-field class="relative">
              <input matInput type="search" placeholder="Buscar por identificación" [(ngModel)]="searchCedula"
                (keyup)="onFilterChange()"
                class="block w-full h-11 p-4 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-transparent focus:ring-indigo-600 focus:border-indigo-600">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
          </div>

          <span class="example-spacer"></span>

          <div>
            <button class="btncrear hover:bg-[#e6510053]" style="background-color: #e65100; color: #ffffff;" (click)="crear()"
              mat-raised-button>
              <i class="fas fa-plus icon-margin-right"></i>
              Nuevo Votante
            </button>
          </div>


        </div>

        <!-- Contenedor de la Tabla -->
        <div class="relative overflow-x-auto p-3">
          <table mat-table [dataSource]="dataSource" matSort class="w-full text-sm text-left rtl:text-right ">

            <!-- Columna: Identificación (Cédula) -->
            <ng-container matColumnDef="Identificacion">
              <th scope="col" class=" border text-xs text-black border-white colcolor" mat-header-cell *matHeaderCellDef
                mat-sort-header>Identificación
              </th>
              <td scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap" mat-cell
                *matCellDef="let row">
                {{ row.Identificacion }} </td>
            </ng-container>

            <!-- Columna: Nombre -->
            <ng-container matColumnDef="Nombre">
              <th scope="col" class=" border text-xs text-black border-white colcolor" mat-header-cell *matHeaderCellDef
                mat-sort-header>
                Nombre Completo </th>
              <td scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap" mat-cell
                *matCellDef="let row">
                {{ row.Nombre }} </td>
            </ng-container>

            <!-- Columna: Correo -->
            <ng-container matColumnDef="Correo">
              <th scope="col" class="border text-xs text-black border-white colcolor" mat-header-cell *matHeaderCellDef
                mat-sort-header>
                Correo Electrónico </th>
              <td scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap" mat-cell
                *matCellDef="let row"> {{ row.Correo }} </td>
            </ng-container>

            <!-- Columna: Perfil (Rol) -->
            <ng-container matColumnDef="Perfil">
              <th scope="col" class="border text-xs text-black border-white colcolor" mat-header-cell *matHeaderCellDef
                mat-sort-header> Perfil </th>
              <td scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap" mat-cell
                *matCellDef="let row"> {{ row.Perfil }} </td>
            </ng-container>

            <!-- Columna: Acciones -->
            <ng-container matColumnDef="accion">
              <th scope="col" class="border text-xs text-black border-white colcolor" mat-header-cell *matHeaderCellDef
                mat-sort-header> Acciones </th>

              <td mat-cell *matCellDef="let row">
                <div class="flex  gap-5">

                  <!-- Botón Detalle -->
                  <button mat-icon-button (click)="redirectDetalle(row.Identificacion)">
                    <mat-icon>visibility</mat-icon>
                  </button>

                  <!-- Botón Editar (No visible si el usuario logueado es Operario intentando editar a un Admin o a sí mismo, según tu lógica original) -->
                  <!-- Nota: Ajusté la condición basándome en tu lógica previa, pero usando el campo Perfil -->
                  <button mat-icon-button (click)="update(row.Identificacion)">
                    <mat-icon>edit</mat-icon>
                  </button>

                  <!-- Botón Eliminar / Desactivar -->
                  <button mat-icon-button (click)="delete(row.Identificacion)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

            <!-- Mensaje de no datos -->
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell no-data-message" [attr.colspan]="displayedColumns.length">
                No se encontraron datos que coincidan con los filtros.
              </td>
            </tr>
          </table>

          <div>
            <!-- Paginador -->
            <mat-paginator #paginator [lang]="'es'" [length]="dataSource.data.length" [pageIndex]="0" [pageSize]="5"
              aria-label="Seleccione una página">
            </mat-paginator>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
<!--Modals-->
<app-votantes-create #votanteFormModal></app-votantes-create>
<app-votantes-detail #votanteDetalleModal></app-votantes-detail>
<app-votantes-desactivar #deleteVotanteModal></app-votantes-desactivar>